<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="It&#39;s my personal blog."><meta name="keywords" content="blog,kricsleo,IT,Web Front End"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Docker | kricsleo</title><link rel="shortcut icon" href="/images/favicon.ico"><link rel="alternate" href="/atom.xml" title="kricsleo"><style>@font-face{font-family:RobotoMono-Iconfont;font-style:normal;font-display:swap;src:url(/fonts/RobotoMono-Iconfont.woff) format("woff")}.loader{position:fixed;width:100%;height:100%;top:0;left:0;background-color:rgba(255,255,255,.7);z-index:999;transition:all .4s}.loader:before{content:'';display:block;position:absolute;left:50%;top:50%;width:50px;height:50px;margin-top:-25px;margin-left:-25px;background-color:#0097e4;-webkit-animation:rotateplane 1.2s infinite ease-in-out;animation:rotateplane 1.2s infinite ease-in-out}.loader:after{content:'loading';font-family:RobotoMono-Iconfont;visibility:hidden}@-webkit-keyframes rotateplane{0%{-webkit-transform:perspective(120px)}50%{-webkit-transform:perspective(120px) rotateY(180deg)}100%{-webkit-transform:perspective(120px) rotateY(180deg) rotateX(180deg)}}@keyframes rotateplane{0%{transform:perspective(120px) rotateX(0) rotateY(0);-webkit-transform:perspective(120px) rotateX(0) rotateY(0)}50%{transform:perspective(120px) rotateX(-180.1deg) rotateY(0);-webkit-transform:perspective(120px) rotateX(-180.1deg) rotateY(0)}100%{transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg);-webkit-transform:perspective(120px) rotateX(-180deg) rotateY(-179.9deg)}}</style></head></html><body><div class="loader"></div><header class="l_header" style="display:none"><div class="wrapper"><div class="nav-main container container--flex"><a class="logo flat-box" href="/">kricsleo</a><div class="menu"><ul class="h-list"><li><a class="flat-box nav-home" href="/">Home</a></li><li><a class="flat-box nav-archives" href="/archives">Archives</a></li><li><a class="flat-box nav-about" href="https://github.com/kricsleo">About</a></li></ul><div class="underline"></div></div><div class="m_search"><form name="searchform" class="form u-search-form"><input type="text" class="input u-search-input" placeholder="Search"> <span class="iconfont icon-search"></span></form></div><ul class="switcher h-list"><li class="s-search"><a href="javascript:void(0)"><span class="iconfont icon-search flat-box"></span></a></li><li class="s-menu"><a href="javascript:void(0)"><span class="iconfont icon-menu flat-box"></span></a></li></ul></div><div class="nav-sub container container--flex"><a class="logo" href="javascript:void(0)">Word of Forks</a><ul class="switcher h-list"><li class="s-comment"><a href="javascript:void(0)"><span class="iconfont icon-chat_bubble_outline flat-box"></span></a></li><li class="s-top"><a href="javascript:void(0)"><span class="iconfont icon-arrow_upward flat-box"></span></a></li><li class="s-toc"><a href="javascript:void(0)"><span class="iconfont icon-format_list_numbered flat-box"></span></a></li></ul></div></div></header><div class="l_body" style="display:none"><div class="container clearfix"><div class="l_main"><article id="post-docker" class="post white-box article-type-post" itemscope itemprop="blogPost"><section class="toc-wrapper active"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker学习笔记"><span class="toc-number">1.</span> <span class="toc-text">docker学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker常用命令"><span class="toc-number">1.1.</span> <span class="toc-text">docker常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编写一个-Dockerfile"><span class="toc-number">1.2.</span> <span class="toc-text">编写一个 Dockerfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker中使用mysql"><span class="toc-number">1.3.</span> <span class="toc-text">docker中使用mysql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装-Elasticsearch"><span class="toc-number">1.4.</span> <span class="toc-text">安装 Elasticsearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-elasticsearch-head"><span class="toc-number">1.4.1.</span> <span class="toc-text">安装 elasticsearch-head</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装中文分词-ik"><span class="toc-number">1.4.2.</span> <span class="toc-text">安装中文分词 ik</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#elasticsearch-的使用"><span class="toc-number">1.4.3.</span> <span class="toc-text">elasticsearch 的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-number">1.5.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></section><section class="article typo"><div class="article-entry" itemprop="articleBody"><h1 id="docker学习笔记"><a href="#docker学习笔记" class="headerlink" title="docker学习笔记"></a>docker学习笔记</h1><p>Docker是一个开源的引擎，可以轻松的为任何应用创建一个轻量级的、可移植的、自给自足的容器。开发者在笔记本上编译测试通过的容器可以批量地在生产环境中部署，包括VMs（虚拟机）、bare metal、OpenStack 集群和其他的基础应用平台.<br><a id="more"></a></p><p>如无特殊说明, 以下操作环境均为<code>CentOS 7</code>, 内核版本位<code>3.10.0-693.2.2.el7.x86_64</code><br>(查看内核版本: <code>uname -r</code>)</p><h2 id="docker常用命令"><a href="#docker常用命令" class="headerlink" title="docker常用命令"></a>docker常用命令</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 安装docker</span></span><br><span class="line">yum install -y docker</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已安装的docker, 或者 docker info</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动docker服务</span></span><br><span class="line">service docker start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看已下载的镜像 或 docker images</span></span><br><span class="line">docker image ls </span><br><span class="line"></span><br><span class="line"><span class="comment"># 从仓库抓取镜像到本地, Docker 官方提供的镜像都存放在 library 组里, 同时这也是默认的组</span></span><br><span class="line"><span class="comment"># 例如 docker image pull library/hello-world 等价于 docker image pull hello-world</span></span><br><span class="line">docker image pull [imageName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除已下载的镜像, 如果有使用该镜像创建的容器, 那么必须先删除对应的容器才能删除镜像</span></span><br><span class="line">docker image rm [imageName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从镜像创建容器并运行</span></span><br><span class="line"><span class="comment"># 给个hello-world的测试例子, 由于本地没有hello-world这个镜像，所以会自动下载一个hello-world的镜像，并在容器内运行。</span></span><br><span class="line">docker run [imageName]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出正在运行的容器</span></span><br><span class="line"><span class="comment"># dcoker container ls</span></span><br><span class="line"><span class="comment"># docker contaienr ls --all 列出所有容器, 包括已停止的</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 停止容器 或强制停止: docker container kill [containID]</span></span><br><span class="line">docker stop [containerId]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动已经停止的容器</span></span><br><span class="line">docker start [containerId]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启容器</span></span><br><span class="line">docker restart [containerId]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除容器</span></span><br><span class="line">docker rm [containerId]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取容器的输出信息</span></span><br><span class="line">docker logs [containerId]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前已经运行的容器(可以看到容器id: CONTAINER_ID)</span></span><br><span class="line">docker ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入容器内部(推荐使用exec)</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [containerId] /bin/bash</span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line"><span class="comment"># -i 以交互方式运行，是阻塞式的</span></span><br><span class="line"><span class="comment"># -t 分配一个伪终端，这个参数通常与-i参数一起使用，然后， 在后面跟上容器里的/bin/bash，这样就把我们带到容器里去了。</span></span><br><span class="line"><span class="comment"># -d 以后台方式执行，这样，我们执行完这条命令，还可以干其他事情，写脚本最常用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看某个容器的日志</span></span><br><span class="line">docker container logs [containerId]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在宿主机和容器之间拷贝文件, 容器未启动也可拷贝</span></span><br><span class="line"><span class="comment"># docker cp containerId:from/path/to/file to/owner/path</span></span><br><span class="line">docker cp from/owner/path containerId:to/path/to/file</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看各容器占用的系统资源</span></span><br><span class="line">docker stats</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存对容器的更改, 生成一个新的镜像</span></span><br><span class="line">docker commit [containerId] [newImageName]</span><br></pre></td></tr></table></figure><h2 id="编写一个-Dockerfile"><a href="#编写一个-Dockerfile" class="headerlink" title="编写一个 Dockerfile"></a>编写一个 Dockerfile</h2><p>我们可以从一个 Dockerfile 来新建一个镜像来满足自己自定义的需求.</p><p>我们一般会新建一个<code>.dockerignore</code>文件, 表示在拷贝文件到镜像中的时候要忽略哪些文件, 就像是<code>.gitignore</code>一样(语法也一样), 一般而言, 我们都会忽略诸如<code>.git</code>和<code>node_modules/</code>等文件夹</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># FROM 表示新建的镜像文件所依赖的基础镜像, 我这里是在8.12.0的版本的node镜像的基础上进行定制的</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">8.12</span>.<span class="number">0</span></span><br><span class="line"><span class="comment"># LABEL 指令用于向镜像中添加元数据，可以通过docker inspect命令查看, 比如下面指定该镜像维护者信息(旧的 MAINTAINER 字段已经废弃)</span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=<span class="string">"kricsleo.com"</span></span></span><br><span class="line"><span class="bash"><span class="comment"># COPY 表示文件拷贝, 第一个参数是本机源文件路径, 第二个参数是镜像中的目的文件路径, 这里表示将当前文件夹下的内容全部拷贝到镜像中的`/workspace/node`目录中</span></span></span><br><span class="line"><span class="bash"><span class="comment"># 与 COPY 类似的命令是 ADD, ADD 的功能更丰富, 除了与 COPY 相同的作用外, 它还可以下载远程的文件拷贝进去, 还可以将压缩的文件自动解压后拷贝到镜像中</span></span></span><br><span class="line"><span class="bash">COPY . /workspace/node</span></span><br><span class="line"><span class="bash"><span class="comment"># WORKDIR 指定镜像中接下来的工作目录, 命令等都将在这个目录上执行</span></span></span><br><span class="line"><span class="bash">WORKDIR /workspace/node</span></span><br><span class="line"><span class="bash"><span class="comment"># RUN 表示新建镜像前要执行的命令, 这里执行了`npm install`将会安装项目的所有依赖, 这些依赖安装完成后都会被打包进入镜像文件中</span></span></span><br><span class="line"><span class="bash"><span class="comment"># RUN 命令可以有多个, 每一个 RUN 命令都会创建一层镜像, 类似于洋葱结构, 后面的 RUN 失败导致镜像构建失败时, 下次重新构建的话会从上一个成功的</span></span></span><br><span class="line"><span class="bash"><span class="comment"># 那一层镜像开始构建, 注意可以按照需求合并 RUN 命令, 可以避免多余的层级</span></span></span><br><span class="line"><span class="bash">RUN npm install</span></span><br><span class="line"><span class="bash"><span class="comment"># EXPOSE 表示向外提供服务的端口号, 可以指定多个, 用空格分开即可, 一般我们可以在后面创建容器的时候使用`-p`参数来将宿主机和容器中暴露的端口号进行映射</span></span></span><br><span class="line"><span class="bash">EXPOSE 3000</span></span><br><span class="line"><span class="bash"><span class="comment"># CMD 表示启动容器之后在容器中要运行的命令, 这里相当于告诉容器运行之后运行`/bin/bash`</span></span></span><br><span class="line"><span class="bash"><span class="comment"># 我们一般在从镜像启动容器的时候类似于`docker run -it &lt;image&gt; /bin/bash`, 这里最后的`/bin/bash`命令会覆盖我们指定的 CMD 命令</span></span></span><br><span class="line"><span class="bash"><span class="comment"># CMD 命令只能存在一个, CMD [command, param1, param2, ...], 后面的参数都会传递给这个命令</span></span></span><br><span class="line"><span class="bash">CMD [<span class="string">'/bin/bash'</span>]</span></span><br></pre></td></tr></table></figure><p>Dockerfile 编写完成以后我们就可以来使用它构建一个镜像了.</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># build 表示开始构建镜像</span></span><br><span class="line"><span class="comment"># -t 表示构建的镜像名和版本标签, 默认是 latest</span></span><br><span class="line"><span class="comment"># -f 指定 Dockerfile 的路径</span></span><br><span class="line"><span class="comment"># 最后的 . 表示工作环境为当前目录, 如果 Dockerfile 也在当前目录, 那么可以不用指定 -f 参数</span></span><br><span class="line">docker build -t [imageName:tag] -f [/path/to/Dockerfile] .</span><br></pre></td></tr></table></figure><p>参考资料:<a href="http://notes.maxwi.com/2017/12/14/docker-Dockerfile/" target="_blank" rel="noopener">Dockerfile的编写</a></p><h2 id="docker中使用mysql"><a href="#docker中使用mysql" class="headerlink" title="docker中使用mysql"></a>docker中使用mysql</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载mysql镜像</span></span><br><span class="line">docker pull mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从镜像创建并运行一个容器</span></span><br><span class="line">docker run --name first-mysql -p 3306:3306 -e MYSQL\_ROOT\_PASSWORD=root -d mysql</span><br><span class="line"><span class="comment"># 参数说明:</span></span><br><span class="line"><span class="comment"># --name 指定容器独一无二的名字</span></span><br><span class="line"><span class="comment"># -p mysql容器的端口映射</span></span><br><span class="line"><span class="comment"># -e &lt;key=value&gt;	设置进入后可以使用的环境变量，这样动态指定比较灵活,  'MYSQL\_ROOT\_PASSWORD'字段指定的是 root</span></span><br><span class="line"><span class="comment"># 用户的密码</span></span><br><span class="line"><span class="comment"># -d 表示使用守护进程, 即服务挂在后台</span></span><br></pre></td></tr></table></figure><p>在我本机连接阿里云上的ECS中的mysql容器时无法连接, 后来排查使用如下解决方案:</p><ol><li>编辑ECS的安全组规则<br>把mysql的通信端口3306加入到允许列表中, 如果你是把docker里面的mysql的端口映射到ECS的其它端口, 比如3307, 那么这里你就把这个映射之后的端口3307加入到运行列表即可;</li><li><p>编辑ECS的防火墙<br>ECS的防火墙可能会拦截3306端口的通信, 那么你需要打开这个端口, 让防火墙允许端口通信, 我的ECS系统是CentOS7, 在CentOS7中是使用<code>firewall</code>来管理端口通信的, 那么使用如下方法加入3306端口:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 永久加入3306端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent</span><br><span class="line"><span class="comment"># 参数说明:</span></span><br><span class="line"><span class="comment"># –zone 作用域</span></span><br><span class="line"><span class="comment"># –add-port=80/tcp 添加端口，格式为：端口/通讯协议</span></span><br><span class="line"><span class="comment"># –permanent 永久生效，没有此参数重启后失效</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启防火墙生效</span></span><br><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>另外附上常用防火墙命令:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#打开防火墙</span></span><br><span class="line">systemctl start firewalld</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看防火墙状态</span></span><br><span class="line">firewall-cmd --state</span><br></pre></td></tr></table></figure></li></ol><h2 id="安装-Elasticsearch"><a href="#安装-Elasticsearch" class="headerlink" title="安装 Elasticsearch"></a>安装 Elasticsearch</h2><p>我安装的版本是<strong>6.5.4</strong>, 需要指定版本安装, 因为没有默认的’lastest’版本</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -it 参数代表分配并且进入该容器的终端, 可以看到命令行详细的启动过程, 也可以进行命令交互</span></span><br><span class="line"><span class="comment"># -d 参数代表在后台守护该容器的进程一直运行</span></span><br><span class="line"><span class="comment"># --name: 为此次运行的容器起一个好记的名字</span></span><br><span class="line"><span class="comment"># 使用 -e 指定多个参数, 因为我服务器是个只有1G内存的小水管, 而 es 在5版本之后的默认最大内存使用是2G, 所以我</span></span><br><span class="line"><span class="comment"># 指定了 ES_JAVA_OPTS="-Xms200m -Xmx200m" 参数来限制最大使用 200m 堆内存, 但是不知道怎么回事, 内存还是会一直往上飙,</span></span><br><span class="line"><span class="comment"># 会远远超过我指定的内存</span></span><br><span class="line"><span class="comment"># 指定 NETWORK_HOST="0.0.0.0", 可以让 es 接受来自任意ip地址的访问</span></span><br><span class="line"><span class="comment"># 最后指定了本次启动的容器从 docker.io/elasticsearch:6.5.4 镜像创建</span></span><br><span class="line">docker run -d --name es -p 9200:9200 -p 9300:9300 -e ES_JAVA_OPTS=<span class="string">"-Xms150m -Xmx150m"</span> -e NETWORK_HOST=<span class="string">"0.0.0.0"</span> docker.io/elasticsearch:6.5.4</span><br></pre></td></tr></table></figure><h3 id="安装-elasticsearch-head"><a href="#安装-elasticsearch-head" class="headerlink" title="安装 elasticsearch-head"></a>安装 elasticsearch-head</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># elasticsearch-head 使用的端口是9100</span></span><br><span class="line">docker run -d -p 9100:9100 docker.io/mobz/elasticsearch-head:5</span><br></pre></td></tr></table></figure><p>然后访问ip:9100, 在页面上填入 es 的地址ip:9200, 如果无法连接, 那么需要在 es 的配置文件 <code>elasticsearch.yml</code>中添加参数</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 如果启用了 HTTP 端口，那么此属性会指定是否允许跨源 REST 请求</span></span><br><span class="line">http.cors.enabled: <span class="literal">true</span></span><br><span class="line"><span class="comment"># 如果 http.cors.enabled 的值为 true，那么该属性会指定允许 REST 请求来自何处</span></span><br><span class="line">http.cors.allow-origin: <span class="string">"*"</span></span><br></pre></td></tr></table></figure><h3 id="安装中文分词-ik"><a href="#安装中文分词-ik" class="headerlink" title="安装中文分词 ik"></a>安装中文分词 ik</h3><p>进入 es 容器中, 使用 es 自带的命令安装插件<br></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 注意安装对应 es 版本的 ik 分词插件, 我的 es 是6.5.4, 所以安装的6.5.4的 ik</span></span><br><span class="line">elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v6.5.4/elasticsearch-analysis-ik-6.5.4.zip</span><br></pre></td></tr></table></figure><p></p><h3 id="elasticsearch-的使用"><a href="#elasticsearch-的使用" class="headerlink" title="elasticsearch 的使用"></a>elasticsearch 的使用</h3><p>参考<a href="https://imququ.com/post/elasticsearch.html" target="_blank" rel="noopener">使用 Elasticsearch 实现博客站内搜索</a></p><p>初始化和写入数据都可以了, 但是现在碰到一个问题, 我的博客主站是托管在 github 上的, github 只提供静态资源服务, 那么我这个部署在阿里云上的 es 要如何联动起来使用上搜索功能呢?</p><p><del>通过 nginx 分发?</del>目前使用 nginx 分发达到了在备用域名 try.kricsleo.com 上可以调用部署在阿里云上的 es 服务</p><p>放出我的博客文章的 mapping</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  index: <span class="string">'blog'</span>,</span><br><span class="line">  type: <span class="string">'article'</span>,</span><br><span class="line">  body: &#123;</span><br><span class="line">    properties: &#123;</span><br><span class="line">      title: &#123;</span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        term_vector: <span class="string">'with_positions_offsets'</span>,</span><br><span class="line">        analyzer: <span class="string">'ik_max_word'</span>,</span><br><span class="line">        search_analyzer: <span class="string">'ik_max_word'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      subtitle: &#123;</span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        term_vector: <span class="string">'with_positions_offsets'</span>,</span><br><span class="line">        analyzer: <span class="string">'ik_max_word'</span>,</span><br><span class="line">        search_analyzer: <span class="string">'ik_max_word'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      content: &#123;</span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">        term_vector: <span class="string">'with_positions_offsets'</span>,</span><br><span class="line">        analyzer: <span class="string">'ik_max_word'</span>,</span><br><span class="line">        search_analyzer: <span class="string">'ik_max_word'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      link: &#123;</span><br><span class="line">        type: <span class="string">'text'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      author: &#123;</span><br><span class="line">        type: <span class="string">'text'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      categories: &#123;</span><br><span class="line">        type: <span class="string">'keyword'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      tags: &#123;</span><br><span class="line">        type: <span class="string">'keyword'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      create_date: &#123;</span><br><span class="line">        type: <span class="string">'date'</span>,</span><br><span class="line">        index: <span class="literal">false</span></span><br><span class="line">      &#125;,</span><br><span class="line">      update_date: &#123;</span><br><span class="line">        type: <span class="string">'date'</span>,</span><br><span class="line">        index: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>搜索时使用的生成 DSL 查询语句的方法</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> generateDSL = <span class="function">(<span class="params">query = <span class="string">''</span>, <span class="keyword">from</span> = <span class="number">0</span>, size = <span class="number">10</span></span>) =&gt;</span> (&#123;</span><br><span class="line">  index: <span class="string">'blog'</span>,</span><br><span class="line">  type: <span class="string">'article'</span>,</span><br><span class="line">  q: query,</span><br><span class="line">  <span class="keyword">from</span>,</span><br><span class="line">  size,</span><br><span class="line">  body: &#123;</span><br><span class="line">    query: &#123;</span><br><span class="line">      dis_max: &#123;</span><br><span class="line">        queries: [</span><br><span class="line">          &#123;</span><br><span class="line">            match: &#123;</span><br><span class="line">              title: &#123;</span><br><span class="line">                query: keyword,</span><br><span class="line">                minimum_should_match: <span class="string">'50%'</span>,</span><br><span class="line">                boost: <span class="number">4</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            match: &#123;</span><br><span class="line">              subtitle: &#123;</span><br><span class="line">                query: keyword,</span><br><span class="line">                minimum_should_match: <span class="string">'50%'</span>,</span><br><span class="line">                boost: <span class="number">4</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            match: &#123;</span><br><span class="line">              content: &#123;</span><br><span class="line">                query: keyword,</span><br><span class="line">                minimum_should_match: <span class="string">'75%'</span>,</span><br><span class="line">                boost: <span class="number">4</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            match: &#123;</span><br><span class="line">              tags: &#123;</span><br><span class="line">                query: keyword,</span><br><span class="line">                minimum_should_match: <span class="string">'100%'</span>,</span><br><span class="line">                boost: <span class="number">2</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, &#123;</span><br><span class="line">            match: &#123;</span><br><span class="line">              categories: &#123;</span><br><span class="line">                query: keyword,</span><br><span class="line">                minimum_should_match: <span class="string">'100%'</span>,</span><br><span class="line">                boost: <span class="number">2</span>,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        tie_breaker: <span class="number">0.3</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    highlight: &#123;</span><br><span class="line">      pre_tags: [<span class="string">'&lt;b&gt;'</span>],</span><br><span class="line">      post_tags: [<span class="string">'&lt;/b&gt;'</span>],</span><br><span class="line">      fields: &#123;</span><br><span class="line">        title: &#123;&#125;,</span><br><span class="line">        content: &#123;&#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://imququ.com/post/elasticsearch.html" target="_blank" rel="noopener">使用 Elasticsearch 实现博客站内搜索</a><br><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">Docker 入门教程</a><br><a href="https://www.xuchuruo.cn/%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85elasticsearch.html" target="_blank" rel="noopener">docker安装elasticSearch以及系列插件</a><br><a href="https://blog.csdn.net/qq_23250633/article/details/81327001" target="_blank" rel="noopener">Docker安装elasticsearch5（爬坑心得）</a>: 内存不足无法启动 es 解决方法</p></div><div class="article-tags tags iconfont icon-tag"><a href="/tags/docker/">docker</a></div><div class="art-item-footer"><span class="art-item-left"><i class="iconfont icon-arrow-circle-left"></i>上一篇: <a href="/vue/" rel="prev" title="vue">vue </a></span><span class="art-item-right">下一篇: <a href="/practical-function-in-javascript/" rel="next" title="Practical-Function-In-Javascript">Practical-Function-In-Javascript </a><i class="iconfont icon-arrow-circle-right"></i></span></div></section></article><script>window.subData={title:"Docker",subtitle:"",tools:!0}</script></div><aside class="l_side"><section class="m_widget about"><img class="avatar" src="" data-src="/images/avatar_blog.png"><div class="content"><div class="desc">Developers&#39; lives matter.</div></div></section><section class="m_widget categories"><div class="header">Categories</div><div class="content"><ul class="entry"><li><a class="flat-box" href="/categories/daily/"><div class="name">daily</div><div class="badget">1</div></a></li><li><a class="flat-box" href="/categories/database/"><div class="name">database</div><div class="badget">1</div></a></li><li><a class="flat-box" href="/categories/framework/"><div class="name">framework</div><div class="badget">1</div></a></li><li><a class="flat-box" href="/categories/front-end/"><div class="name">front-end</div><div class="badget">27</div></a></li><li><a class="flat-box" href="/categories/http/"><div class="name">http</div><div class="badget">2</div></a></li><li><a class="flat-box" href="/categories/tool/"><div class="name">tool</div><div class="badget">6</div></a></li><li><a class="flat-box" href="/categories/translation/"><div class="name">translation</div><div class="badget">1</div></a></li></ul></div></section><div class="m_widget tagcloud"><div class="header">Tags</div><div class="content"><a href="/tags/AST/" style="font-size:14px;color:grey">AST</a> <a href="/tags/CORS/" style="font-size:14px;color:grey">CORS</a> <a href="/tags/CSS/" style="font-size:14px;color:grey">CSS</a> <a href="/tags/Content-Type/" style="font-size:14px;color:grey">Content-Type</a> <a href="/tags/ES6/" style="font-size:17px;color:#404040">ES6</a> <a href="/tags/HTTP/" style="font-size:14px;color:grey">HTTP</a> <a href="/tags/HTTP-2-0/" style="font-size:14px;color:grey">HTTP/2.0</a> <a href="/tags/JavaScript/" style="font-size:14px;color:grey">JavaScript</a> <a href="/tags/MVC/" style="font-size:14px;color:grey">MVC</a> <a href="/tags/MVP/" style="font-size:14px;color:grey">MVP</a> <a href="/tags/MVVM/" style="font-size:14px;color:grey">MVVM</a> <a href="/tags/Mini-Program/" style="font-size:14px;color:grey">Mini-Program</a> <a href="/tags/SASS/" style="font-size:14px;color:grey">SASS</a> <a href="/tags/ast/" style="font-size:14px;color:grey">ast</a> <a href="/tags/async/" style="font-size:14px;color:grey">async</a> <a href="/tags/callback/" style="font-size:14px;color:grey">callback</a> <a href="/tags/codeStyle/" style="font-size:14px;color:grey">codeStyle</a> <a href="/tags/cookie/" style="font-size:14px;color:grey">cookie</a> <a href="/tags/css/" style="font-size:20px;color:#000">css</a> <a href="/tags/docker/" style="font-size:14px;color:grey">docker</a> <a href="/tags/elasticsearch/" style="font-size:14px;color:grey">elasticsearch</a> <a href="/tags/encrypt/" style="font-size:17px;color:#404040">encrypt</a> <a href="/tags/flex/" style="font-size:14px;color:grey">flex</a> <a href="/tags/function/" style="font-size:14px;color:grey">function</a> <a href="/tags/git/" style="font-size:20px;color:#000">git</a> <a href="/tags/h5/" style="font-size:17px;color:#404040">h5</a> <a href="/tags/http/" style="font-size:14px;color:grey">http</a> <a href="/tags/javascript/" style="font-size:14px;color:grey">javascript</a> <a href="/tags/js怪异事件录/" style="font-size:14px;color:grey">js怪异事件录</a> <a href="/tags/markdown/" style="font-size:14px;color:grey">markdown</a> <a href="/tags/nginx/" style="font-size:14px;color:grey">nginx</a> <a href="/tags/nodejs/" style="font-size:14px;color:grey">nodejs</a> <a href="/tags/object/" style="font-size:14px;color:grey">object</a> <a href="/tags/optimize/" style="font-size:14px;color:grey">optimize</a> <a href="/tags/promise/" style="font-size:14px;color:grey">promise</a> <a href="/tags/react/" style="font-size:14px;color:grey">react</a> <a href="/tags/redux/" style="font-size:14px;color:grey">redux</a> <a href="/tags/same-origin/" style="font-size:14px;color:grey">same-origin</a> <a href="/tags/service-worker/" style="font-size:14px;color:grey">service-worker</a> <a href="/tags/shell/" style="font-size:14px;color:grey">shell</a> <a href="/tags/speed/" style="font-size:14px;color:grey">speed</a> <a href="/tags/ssh/" style="font-size:14px;color:grey">ssh</a> <a href="/tags/toLocaleString/" style="font-size:14px;color:grey">toLocaleString</a> <a href="/tags/vue/" style="font-size:14px;color:grey">vue</a> <a href="/tags/web-font/" style="font-size:14px;color:grey">web-font</a> <a href="/tags/web优化/" style="font-size:14px;color:grey">web优化</a> <a href="/tags/yahoo/" style="font-size:14px;color:grey">yahoo</a> <a href="/tags/前端模块化/" style="font-size:14px;color:grey">前端模块化</a> <a href="/tags/国际化/" style="font-size:14px;color:grey">国际化</a></div></div><section class="m_widget links"><div class="header">Links</div><div class="content"><ul class="entry"><li><a class="flat-box" target="_blank" href="https://996.icu/#/zh_CN"><div class="name">996.icu</div></a></li></ul></div></section></aside></div></div><footer class="l_footer clearfix" style="display:none"><div class="copyright">©2018 By <a href="https://github.com/kricsleo">kricsleo</a></div><div class="framework-info">Diven - <a href="https://hexo.io/zh-cn/">Hexo</a></div></footer><script>function loadCSS() {
    const doc = document;
    const link = doc.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/style.css';
    // link.href = 'https://store.kricsleo.com/blog/static/css/style.css';
    link.onload = () => {
      const dLoader = doc.getElementsByClassName('loader')[0];
      dLoader.style.opacity = 0;
      setTimeout(() => {
        dLoader.parentNode.removeChild(dLoader);
      }, 400);
    }
    doc.head.appendChild(link);
  }
  loadCSS();</script><script src="/js/index.js"></script></body>